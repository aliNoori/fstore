import{$ as Ne,_ as Oe,g as Ae,h as d,u as We,q as Fe,X as Ie,c as a,b as x,a as e,F as y,r as k,f as m,d as v,t as n,x as l,n as b,j as U,v as Me,w as oe,z as Ue,e as Ee,o as r,i as ne,l as j,y as Le,R as qe}from"./DHCY8KTh.js";const Be=Ne("step",{state:()=>({currentStep:1}),actions:{setStep(D){this.currentStep=D}}}),Re={key:0,style:{"margin-top":"80px"}},Ve={class:"progress-container"},xe={class:"steps-wrapper"},je={class:"step-name"},De={class:"step-content"},Je={key:0,class:"page card"},Te={class:"items"},ze={class:"image"},Ge=["src","alt"],Xe={class:"product-details"},He={class:"product-name"},Ke={class:"product-price"},Qe={class:"product-quantity"},Ye={class:"buttons"},Ze=["onClick"],et={class:"controls"},tt={key:1,class:"page addresses"},st={id:"address-selection-page"},ot={class:"address-cards-container"},nt=["onClick"],lt={class:"address-content"},at={class:"address-buttons"},rt=["onClick"],it=["onClick"],dt={class:"controls"},ut={key:2,class:"page shipping-methods"},ct={id:"shipping-method-selection-page"},pt={class:"shipping-cards-container"},vt=["onClick"],mt=["value"],ht={key:0,class:"checkmark-shipping"},_t={class:"controls"},gt={key:3,class:"page invoice"},yt={class:"body"},ft={key:0},kt={class:"invoice-container"},bt={class:"invoice-header"},wt={class:"user-details"},Ct={class:"invoice-items"},St=["src","alt"],$t={key:0},Pt={class:"invoice-summary"},Nt={class:"total"},Ot={class:"controls"},At={key:4,class:"page payment"},Wt={id:"payment-method-selection-page"},Ft={class:"payment-cards-container"},It=["onClick"],Mt=["value"],Ut={class:"header-payment-card"},Et=["src","alt"],Lt={key:0},qt={key:1},Bt={key:0,class:"checkmark"},Rt={class:"controls"},Vt={key:5},xt={class:"page online-payment-methods"},jt={id:"online-method-selection-page"},Dt={class:"online-cards-container"},Jt=["onClick"],Tt=["value"],zt=["src","alt"],Gt={key:0,class:"checkmark"},Xt={class:"controls"},Ht={key:6},Kt={class:"page offline-payment-methods"},Qt={class:"wallet-method-selection-page"},Yt={class:"wallet-card-container"},Zt={class:"controls"},es={key:0,class:"popup-overlay"},ts={class:"popup"},ss={class:"popup-controls"},os={key:1,class:"popup-transaction-overlay"},ns={class:"popup-transaction"},ls={class:"transaction-details"},as={class:"popup-controls"},rs={key:7},is={class:"page offline-payment-methods"},ds={class:"coupon-cards-selection-page"},us={class:"coupons-card-container"},cs=["onClick"],ps={class:"coupon-header"},vs={class:"coupon-title"},ms={class:"coupon-date"},hs={class:"coupon-body"},_s={class:"coupon-footer"},gs={class:"coupon-status"},ys={class:"controls"},fs={key:1,class:"empty-cart"},ks={__name:"steps-to-order",setup(D){const E=Ae(),L=[{number:1,name:"سبد"},{number:2,name:"آدرس"},{number:3,name:"ارسال"},{number:4,name:"فاکتور"},{number:5,name:"درگاه"},{number:6,name:"پرداخت"}],q=Be(),c=d(q.currentStep),f=()=>{c.value<L.length&&c.value++},w=()=>{c.value>1&&c.value--},le=s=>s==="Online"?"آنلاین":s==="Wallet"?"کیف پول":s==="OtherWays"?"از طرق دیگر":s,ae=s=>s==="Online"?"پرداخت از طریق درگاه های بانکی":s==="Wallet"?"پرداخت از طریق کیف پول":s==="OtherWays"?"پرداخت از طریق کارت جایزه و ...":s,re=s=>s==="parsian"?"پارسیان":s==="mellat"?"ملت":s==="melli"?"ملی":s,{$axios:p,$toPersian:i,$toPersianDate:B,$formatPrice:h,$parseDateTime:ie}=We(),g=d({}),J=Le(),T=d(!1),de=()=>!!localStorage.getItem("auth_token"),ue=async()=>{if(T.value=de(),T.value)try{const s=await p.get("cart/items/show");g.value=s.data}catch(s){console.error("Error fetching cart items:",s)}},ce=async s=>{try{(await p.post(`cart/item/remove/${s}`)).status===200?g.value.cart.items.forEach(A=>{A.product.id===s&&(A.quantity>1?A.quantity--:g.value.cart.items=g.value.cart.items.filter(M=>M.product.id!==s))}):alert("Error removing the item from the cart.")}catch(t){console.error("Error removing from cart:",t)}},z=d([]),G=async()=>{try{const s=await p.get("user/addresses");z.value=s.data.addresses}catch(s){console.error("Failed to load addresses:",s)}},O=d(null),X=d([]),pe=async()=>{if(!O.value){console.error("No address selected");return}try{const s=await p.post(`user/create/order/${O.value}`);X.value=s.data.order,localStorage.setItem("order_number",JSON.stringify(X.value.order_number)),console.log("Address added to order:",s.data.order)}catch(s){console.error("Failed to add address to order:",s)}},ve=s=>{E.push(`/edit-address/${s}`)},me=s=>{O.value=s,console.log(`آدرس با شناسه ${s} انتخاب شد.`)},he=async()=>{await E.push("/add-new-address")},H=d([]),C=d(null),_e=async()=>{try{const s=await p.get("/shippingMethod/list");H.value=s.data.shippingMethods}catch(s){console.error("Failed to load shippingMethods:",s)}},ge=async()=>{if(!C.value){console.error("No shippingMethod selected");return}try{const s=JSON.parse(localStorage.getItem("order_number")),t=await p.post(`user/addShipping/${C.value}/order/${s}`);console.log("ShippingMethod added to order:",t.data)}catch(s){console.error("Failed to add shippingMethod to order:",s)}},_=d({}),R=d(!0),V=d({}),ye=async()=>{try{const s=JSON.parse(localStorage.getItem("order_number")),t=await p.get(`invoice/create/${s}`);_.value=t.data.invoice}catch(s){console.error("Invoice error:",s.response?s.response.data:s)}finally{R.value=!1}},fe=async()=>{try{const s=await p.get("user/profile");V.value=s.data,R.value=!1}catch(s){console.error("Fetch user error:",s.response?s.response.data:s)}},W=d(null),K=d([]),S=d(null),ke=async()=>{try{const s=await p.get("/paymentMethod/list");K.value=s.data.paymentMethods}catch(s){console.error("Failed to load shippingMethods:",s)}},be=async()=>{if(!S.value){console.error("No shippingMethod selected");return}try{const s=await p.post(`user/manageSelectedPayment/${S.value}`);W.value=s.data.action,s.data.action==="Online"?(console.log("action1 :",s.data.action),await we()):s.data.action==="Wallet"?(console.log("action2 :",s.data.action),await Ce()):s.data.action==="OtherWays"&&(console.log("action3 :",s.data.action),await $e())}catch(s){console.error("Failed to selected paymentMethod :",s)}},Q=d([]),$=d(null),we=async()=>{try{const s=await p.get("/onlineMethodGateway/list");Q.value=s.data.onlinePaymentMethods}catch(s){console.error("Failed to load onlineMethods:",s)}},Y=async()=>{if(!$.value){console.error("No OnlineMethod selected");return}try{const s=JSON.parse(localStorage.getItem("order_number")),t=await p.post(`user/processPayment/${s}/${$.value}`);console.log("url :",t.data.url),window.location.href=t.data.url}catch(s){console.error("Failed to selected onlinePaymentMethods :",s)}},P=d({}),Z=d({}),ee=d(null),F=d(null),N=d(null),te=d(!1),Ce=async()=>{try{const s=await p.get("user/my/wallet");P.value=s.data.wallet}catch(s){console.error("خطا در دریافت اطلاعات کیف پول:",s)}},Se=async()=>{if(!F.value){console.error("No Wallet selected");return}try{const s=JSON.parse(localStorage.getItem("order_number")),t=await p.post(`user/processPayment/${s}/${F.value}/paymentWithWallet`);console.log("url :",t.data.transaction),N.value=t.data.transaction,te.value=!0}catch(s){console.error("Failed to selected walletMethods :",s)}},$e=async()=>{try{const s=await p.get("user/my/coupons");Z.value=s.data.coupons}catch(s){console.error("خطا در دریافت اطلاعات  کپن های کاربر:",s)}},I=d(!1),se=d(0),Pe=async()=>{try{const s=await p.post(`user/wallet/${P.id}/charge`);P.balance=s.data.new_balance,I.value=!1}catch(s){console.error("خطا در افزایش موجودی کیف پول:",s)}};return Fe(()=>{ue(),c.value===2&&G()}),Ie(),d(""),E.afterEach((s,t)=>{console.log("afterEach",s.path,t.path),s.path==="/add-new-address"&&(q.setStep(2),c.value=q.currentStep)}),(s,t)=>{const A=qe,M=Ee;return r(),a(y,null,[x(A),g.value&&g.value.cart&&g.value.cart.items&&g.value.cart.items.length?(r(),a("div",Re,[e("div",Ve,[e("div",xe,[(r(),a(y,null,k(L,(o,u)=>e("div",{key:u,class:"step-container"},[e("span",{class:b(["step-circle",{"step-active":u+1<=c.value},{"step-raised":u+1===c.value}])},"✓",2),e("div",je,[e("span",null,n(o.name),1)]),u<L.length-1?(r(),a("div",{key:0,class:b(["step-line",{"line-active":u+1<c.value}])},null,2)):m("",!0)])),64))])]),e("div",De,[c.value===1?(r(),a("div",Je,[t[16]||(t[16]=e("h2",null,"سبد خرید",-1)),e("div",Te,[(r(!0),a(y,null,k(g.value.cart.items,o=>(r(),a("div",{key:o.id,class:"item-card"},[e("div",ze,[e("img",{src:o.product.image?`${l(J).public.API_BASE_URL}${o.product.image.path}`:"/default-product-image.jpg",alt:o.product.name},null,8,Ge)]),e("div",Xe,[e("div",He,n(o.product.name),1),e("div",Ke,"قیمت:"+n(l(i)(l(h)(o.product.price))),1),e("div",Qe,"تعداد:"+n(l(i)(o.quantity)),1)]),e("div",Ye,[x(M,{to:`/product/${o.product.id}`},{default:oe(()=>t[15]||(t[15]=[e("button",{class:"product-info-btn"},"اطلاعات محصول",-1)])),_:2},1032,["to"]),e("button",{onClick:u=>ce(o.product.id),class:"rm-item-card-btn"},"حذف از سبد خرید",8,Ze)])]))),128))]),e("div",et,[e("button",{onClick:t[0]||(t[0]=()=>{G(),f()})},"ثبت آدرس")])])):m("",!0),c.value===2?(r(),a("div",tt,[t[20]||(t[20]=e("h2",null,"ثبت آدرس",-1)),e("div",st,[e("div",ot,[(r(!0),a(y,null,k(z.value,o=>(r(),a("div",{key:o.id,class:b(["address-card",{selected:O.value===o.id}]),onClick:u=>O.value=o.id},[e("div",lt,[e("h3",null,n(l(i)(o.street)),1),e("p",null,n(o.city)+", "+n(o.state)+", "+n(o.country),1)]),e("div",at,[e("button",{onClick:ne(u=>ve(o.id),["stop"]),class:"edit-address-btn"},t[17]||(t[17]=[e("i",{class:"fas fa-edit"},null,-1),v(" ویرایش ")]),8,rt),e("button",{onClick:ne(u=>me(o.id),["stop"]),class:"select-address-btn"},t[18]||(t[18]=[e("i",{class:"fas fa-check-circle"},null,-1),v(" انتخاب ")]),8,it)])],10,nt))),128)),e("div",{class:"add-address-card",onClick:he},t[19]||(t[19]=[e("div",{class:"add-address-icon"},[e("i",{class:"fas fa-plus"})],-1),e("p",null,"افزودن آدرس جدید",-1)]))])]),e("div",dt,[e("button",{onClick:t[1]||(t[1]=()=>{pe(),_e(),O.value&&f()})},"ثبت روش ارسال"),e("button",{onClick:w},"برگشت به سبد خرید")])])):m("",!0),c.value===3?(r(),a("div",ut,[t[21]||(t[21]=e("h2",null,"نوع ارسال",-1)),e("div",ct,[e("div",pt,[(r(!0),a(y,null,k(H.value,o=>(r(),a("div",{key:o.id,class:b(["shipping-card",{selected:C.value===o.id}]),onClick:u=>C.value=o.id},[e("label",null,[U(e("input",{type:"radio",value:o.id,"onUpdate:modelValue":t[2]||(t[2]=u=>C.value=u),required:"",hidden:""},null,8,mt),[[j,C.value]]),e("h3",null,n(o.name),1),e("p",null,n(l(i)(o.description)),1),e("p",null,"هزینه : "+n(l(i)(o.cost)),1),e("p",null,"مدت زمان تحویل :"+n(l(i)(o.delivery_time)),1),C.value===o.id?(r(),a("span",ht,"✓")):m("",!0)])],10,vt))),128))]),e("div",_t,[e("button",{onClick:t[3]||(t[3]=()=>{ge().then(fe).then(ye).then(f).catch(o=>console.error(o))})},"صدور فاکتور "),e("button",{onClick:w},"برگشت به انتخاب آدرس")])])])):m("",!0),c.value===4?(r(),a("div",gt,[t[33]||(t[33]=e("h2",null,"صدور فاکتور",-1)),e("div",yt,[R.value?(r(),a("div",ft," Loading...")):m("",!0),e("div",kt,[e("div",bt,[t[27]||(t[27]=e("div",{class:"store-details"},[e("h2",null,[v("فروشگاه"),e("br"),v("آنلاین")])],-1)),e("div",wt,[e("p",null,[t[22]||(t[22]=e("strong",null,"شماره فاکتور:",-1)),v(" "+n(l(i)(_.value.invoice_number)),1)]),e("p",null,[t[23]||(t[23]=e("strong",null,"تاریخ:",-1)),v(" "+n(l(i)(l(B)(_.value.created_at))),1)]),e("p",null,[t[24]||(t[24]=e("strong",null,"خریدار:",-1)),v(" "+n(V.value.name),1)]),e("p",null,[t[25]||(t[25]=e("strong",null,"تلفن:",-1)),v(" "+n(l(i)("058-362-10992")),1)]),e("p",null,[t[26]||(t[26]=e("strong",null,"پست الکترونیکی:",-1)),v(" "+n(V.value.email),1)])])]),e("div",Ct,[e("table",null,[t[29]||(t[29]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"تصویر"),e("th",null,"محصول"),e("th",null,"تعداد"),e("th",null,"قیمت"),e("th",null,"مجموع"),e("th",null,"تخفیف"),e("th",null,"قیمت نهایی")])],-1)),e("tbody",null,[(r(!0),a(y,null,k(_.value.items,(o,u)=>(r(),a("tr",{key:u},[e("td",null,n(u+1),1),e("td",null,[e("img",{src:o.product.image?`${l(J).public.API_BASE_URL}${o.product.image.path}`:"/default-product-image.jpg",alt:o.product.name,class:"product-image"},null,8,St)]),e("td",null,n(o.product.name),1),e("td",null,n(l(i)(o.quantity)),1),e("td",null,n(l(i)(l(h)(o.price))),1),e("td",null,n(l(i)(l(h)(o.total))),1),e("td",null,n(l(i)(l(h)(o.discount))),1),e("td",null,n(l(i)(l(h)(o.price_with_discount))),1)]))),128)),_.value.items.length?m("",!0):(r(),a("tr",$t,t[28]||(t[28]=[e("td",{colspan:"8"},"محصولی موجود نیست",-1)])))])])]),e("div",Pt,[e("div",null,[t[30]||(t[30]=e("span",null,"جمع کل:",-1)),e("strong",null,n(l(i)(l(h)(_.value.sub_total_amount))),1)]),e("div",null,[e("span",null,"مالیات ("+n(l(i)(l(h)(_.value.tax_rate)))+"%):",1),e("strong",null,n(l(i)(l(h)(_.value.tax))),1)]),e("div",null,[t[31]||(t[31]=e("span",null,"هزینه ارسال:",-1)),e("strong",null,n(l(i)(l(h)(_.value.shipping_cost))),1)]),e("div",Nt,[t[32]||(t[32]=e("span",null,"مجموع کل:",-1)),e("strong",null,n(l(i)(l(h)(_.value.total_amount))),1)])])])]),e("div",Ot,[e("button",{onClick:t[4]||(t[4]=()=>{ke().then(f).catch(o=>console.error(o))})},"انتخاب روش پرداخت "),e("button",{onClick:w},"برگست به روش ارسال")])])):m("",!0),c.value===5?(r(),a("div",At,[t[35]||(t[35]=e("h2",null,"انتخاب روش پرداخت",-1)),e("div",Wt,[e("div",Ft,[(r(!0),a(y,null,k(K.value,o=>(r(),a("div",{key:o.id,class:b(["payment-card",{selected:S.value===o.id}]),onClick:u=>S.value=o.id},[e("label",null,[U(e("input",{type:"radio",value:o.id,"onUpdate:modelValue":t[5]||(t[5]=u=>S.value=u),required:"",hidden:""},null,8,Mt),[[j,S.value]]),e("div",Ut,[e("h3",null,n(le(o.name)),1),e("img",{src:o.image?`${s.$config.public.API_BASE_URL}${o.image.path}`:"/default-payment-image.jpg",alt:o.name},null,8,Et)]),e("p",null,n(ae(o.name)),1),e("p",null,[t[34]||(t[34]=v("فعال/غیرفعال : ")),o.is_active===1?(r(),a("span",Lt,"فعال")):(r(),a("span",qt,"غیرفعال"))]),S.value===o.id?(r(),a("span",Bt,"✓")):m("",!0)])],10,It))),128))])]),e("div",Rt,[e("button",{onClick:t[6]||(t[6]=()=>{be().then(f).catch(o=>console.error(o))})},"انتخاب درگاه پرداخت "),e("button",{onClick:w},"برگشت به صدور فاکتور")])])):m("",!0),c.value===6&&W.value==="Online"?(r(),a("div",Vt,[e("div",xt,[t[36]||(t[36]=e("h2",null,"انتخاب درگاه پرداخت",-1)),e("div",jt,[e("div",Dt,[(r(!0),a(y,null,k(Q.value,o=>(r(),a("div",{key:o.id,class:b(["online-card",{selected:$.value===o.id}]),onClick:u=>$.value=o.id},[U(e("input",{type:"radio",value:o.id,"onUpdate:modelValue":t[7]||(t[7]=u=>$.value=u),required:"",hidden:""},null,8,Tt),[[j,$.value]]),e("h3",null,n(re(o.gateway)),1),e("img",{src:o.image?`${s.$config.public.API_BASE_URL}${o.image.path}`:"/default-payment-image.jpg",alt:o.name},null,8,zt),$.value===o.id?(r(),a("span",Gt,"✓")):m("",!0)],10,Jt))),128))]),e("div",Xt,[e("button",{onClick:t[8]||(t[8]=()=>{Y().then(f).catch(o=>console.error(o))})},"اتصال به درگاه "),e("button",{onClick:w},"برگشت به انتخاب روش پرداخت")])])])])):c.value===6&&W.value==="Wallet"?(r(),a("div",Ht,[e("div",Kt,[t[39]||(t[39]=e("h2",null,"پرداخت با کیف پول",-1)),e("div",Qt,[e("div",Yt,[t[38]||(t[38]=e("div",null,[e("p",null,"کیف پول")],-1)),e("div",{class:b(["wallet-card",{selected:F.value===P.value.id}]),onClick:t[9]||(t[9]=o=>F.value=P.value.id)},[t[37]||(t[37]=e("span",null,"موجودی: ",-1)),e("strong",null,n(l(i)(l(h)(P.value.balance)))+" تومان",1)],2)]),e("div",Zt,[P.value.balance>=_.value.total_amount?(r(),a("button",{key:0,onClick:t[10]||(t[10]=()=>{Se().then(f).catch(o=>console.error(o))})}," پرداخت سفارش ")):(r(),a("button",{key:1,onClick:t[11]||(t[11]=o=>I.value=!0)}," افزایش موجودی ")),e("button",{onClick:w},"برگشت به انتخاب روش پرداخت")])])]),I.value?(r(),a("div",es,[e("div",ts,[t[40]||(t[40]=e("h3",null,"افزایش موجودی کیف پول",-1)),t[41]||(t[41]=e("label",{for:"amount"},"مقدار افزایش موجودی:",-1)),U(e("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=o=>se.value=o),id:"amount",class:"modern-input",step:"any"},null,512),[[Me,se.value]]),e("div",ss,[e("button",{onClick:Pe,class:"modern-button"},"افزایش"),e("button",{onClick:t[13]||(t[13]=o=>I.value=!1),class:"modern-button"},"لغو")])])])):m("",!0),te.value?(r(),a("div",os,[e("div",ns,[t[48]||(t[48]=e("div",{class:"popup-header"},[e("span",{class:"icon-check-circle"}),e("h3",null,"تراکنش شما با موفقیت انجام شد")],-1)),e("div",ls,[e("p",null,[t[42]||(t[42]=e("strong",null,"شماره سفارش:",-1)),v(" "+n(N.value.order.order_number),1)]),e("p",null,[t[43]||(t[43]=e("strong",null,"مبلغ تراکنش:",-1)),v(" "+n(l(i)(l(h)(N.value.amount)))+" تومان",1)]),e("p",null,[t[44]||(t[44]=e("strong",null,"کد تراکنش:",-1)),v(" "+n(N.value.code),1)]),e("p",null,[t[45]||(t[45]=e("strong",null,"تاریخ تراکنش:",-1)),v(" "+n(l(i)(l(B)(N.value.date))),1)]),e("p",null,[t[46]||(t[46]=e("strong",null,"زمان تراکنش:",-1)),v(" "+n(l(i)(l(ie)(N.value.date))),1)])]),e("div",as,[x(M,{to:`/order/${N.value.order.id}`,class:"modern-button"},{default:oe(()=>t[47]||(t[47]=[v("بستن")])),_:1},8,["to"])])])])):m("",!0)])):c.value===6&&W.value==="OtherWays"?(r(),a("div",rs,[e("div",is,[t[51]||(t[51]=e("h2",null,"پرداخت با کارت تخفیف",-1)),e("div",ds,[t[50]||(t[50]=e("p",null,"کارت های تخفیف",-1)),e("div",us,[(r(!0),a(y,null,k(Z.value,o=>(r(),a("div",{key:o.id,class:b(["coupon-card",{selected:ee.value===o.id}]),onClick:u=>ee.value=o.id},[e("div",ps,[e("div",vs,n(l(i)(o.code)),1),e("div",ms,"تاریخ اعتبار: "+n(l(i)(l(B)(o.created_at))),1)]),e("div",hs,[e("p",null,"تخفیف : "+n(l(i)(o.discount_amount))+" "+n(o.discount_type),1),e("p",null,"توضیحات : "+n(o.description),1)]),e("div",_s,[e("div",gs,n(o.is_used?"استفاده شده":"اعتبار دارد"),1),t[49]||(t[49]=e("div",{class:"coupon-actions"},[e("a",{href:"#"},"Use Coupon")],-1))])],10,cs))),128))]),e("div",ys,[e("button",{onClick:t[14]||(t[14]=()=>{Y().then(f).catch(o=>console.error(o))})},"پرداخت سفارش "),e("button",{onClick:w},"برگشت به انتخاب روش پرداخت")])])])])):m("",!0)])])):(r(),a("div",fs,t[52]||(t[52]=[Ue('<p data-v-ae484de1>سبد خرید شما خالی است. لطفا محصولات مورد نظر خود را به سبد خرید اضافه کنید.</p><div class="cart-icons" data-v-ae484de1><a href="https://telegram.org" data-v-ae484de1><i class="fab fa-telegram-plane" data-v-ae484de1></i></a><a href="https://instagram.com" data-v-ae484de1><i class="fab fa-instagram" data-v-ae484de1></i></a><a href="https://whatsapp.com" data-v-ae484de1><i class="fab fa-whatsapp" data-v-ae484de1></i></a></div>',2)])))],64)}}},ws=Oe(ks,[["__scopeId","data-v-ae484de1"]]);export{ws as default};
