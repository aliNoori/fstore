import{_ as ce}from"./CujYvPgH.js";import{_ as ue,f as ve,g as c,u as pe,m as me,c as a,a as e,F as _,r as g,e as h,d as k,t as n,q as l,n as y,o as r,b as _e,w as he,i as G,h as q,j as E,s as ge}from"./DosOeQ8X.js";const ye={class:"progress-container"},fe={class:"steps-wrapper"},ke={class:"step-name"},be={class:"step-content"},Ce={key:0,class:"page card"},we={class:"items"},$e={class:"image"},Se=["src","alt"],Pe={class:"product-details"},Ae={class:"product-name"},Ne={class:"product-price"},Oe={class:"product-quantity"},Fe={class:"buttons"},Ie=["onClick"],Ue={class:"controls"},qe={key:1,class:"page addresses"},Ee={id:"address-selection-page"},Me={class:"address-cards-container"},Le=["onClick"],Be={class:"address-content"},Re={class:"address-buttons"},Ve=["onClick"],je=["onClick"],xe={class:"controls"},Je={key:2,class:"page shipping-methods"},De={id:"shipping-method-selection-page"},Te={class:"shipping-cards-container"},We=["onClick"],ze=["value"],Ge={class:"controls"},He={key:3,class:"page invoice"},Ke={class:"body"},Qe={key:0},Xe={class:"invoice-container"},Ye={class:"invoice-header"},Ze={class:"user-details"},et={class:"invoice-items"},tt=["src","alt"],st={key:0},ot={class:"invoice-summary"},nt={class:"total"},lt={class:"controls"},at={key:4,class:"page payment"},rt={id:"payment-method-selection-page"},it={class:"payment-cards-container"},dt=["onClick"],ct=["value"],ut={class:"header-payment-card"},vt=["src","alt"],pt={class:"controls"},mt={key:5},_t={class:"page online-payment-methods"},ht={id:"online-method-selection-page"},gt={class:"online-cards-container"},yt=["onClick"],ft=["value"],kt=["src","alt"],bt={class:"controls"},Ct={key:6},wt={class:"page offline-payment-methods"},$t={class:"offline-method-selection-page"},St={class:"wallet-card-container"},Pt={class:"coupons-card-container"},At=["onClick"],Nt={class:"coupon-header"},Ot={class:"coupon-title"},Ft={class:"coupon-date"},It={class:"coupon-body"},Ut={class:"coupon-footer"},qt={class:"coupon-status"},Et={class:"controls"},Mt={__name:"steps-to-order",setup(Lt){const M=ve(),O=[{number:1,name:"سبد"},{number:2,name:"آدرس"},{number:3,name:"ارسال"},{number:4,name:"فاکتور"},{number:5,name:"درگاه"},{number:6,name:"پرداخت"}],u=c(1),f=()=>{u.value<O.length&&u.value++},b=()=>{u.value>1&&u.value--},{$axios:v,$toPersian:i,$toPersianDate:L,$formatPrice:p}=pe(),S=c({}),B=ge(),H=async()=>{try{const o=await v.get("cart/items/show");S.value=o.data}catch(o){console.error("Error fetching cart items:",o)}},K=async o=>{try{(await v.post(`cart/item/remove/${o}`)).status===200?S.value.cart.items.forEach(A=>{A.product.id===o&&(A.quantity>1?A.quantity--:S.value.cart.items=S.value.cart.items.filter(s=>s.product.id!==o))}):alert("Error removing the item from the cart.")}catch(t){console.error("Error removing from cart:",t)}},R=c([]),Q=async()=>{try{const o=await v.get("user/addresses");R.value=o.data.addresses}catch(o){console.error("Failed to load addresses:",o)}},P=c(null),V=c([]),X=async()=>{if(!P.value){console.error("No address selected");return}try{const o=await v.post(`user/create/order/${P.value}`);V.value=o.data.order,localStorage.setItem("order_number",JSON.stringify(V.value.order_number)),console.log("Address added to order:",o.data.order)}catch(o){console.error("Failed to add address to order:",o)}},Y=o=>{M.push(`/edit-address/${o}`)},Z=o=>{P.value=o,console.log(`آدرس با شناسه ${o} انتخاب شد.`)},ee=async()=>{await M.push("/add-new-address")},j=c([]),C=c(null),te=async()=>{try{const o=await v.get("/shippingMethod/list");j.value=o.data.shippingMethods}catch(o){console.error("Failed to load shippingMethods:",o)}},se=async()=>{if(!C.value){console.error("No shippingMethod selected");return}try{const o=JSON.parse(localStorage.getItem("order_number")),t=await v.post(`user/addShipping/${C.value}/order/${o}`);console.log("ShippingMethod added to order:",t.data)}catch(o){console.error("Failed to add shippingMethod to order:",o)}},m=c({}),F=c(!0),I=c({}),oe=async()=>{try{const o=JSON.parse(localStorage.getItem("order_number")),t=await v.get(`invoice/create/${o}`);m.value=t.data.invoice}catch(o){console.error("Invoice error:",o.response?o.response.data:o)}finally{F.value=!1}},ne=async()=>{try{const o=await v.get("user/profile");I.value=o.data,F.value=!1}catch(o){console.error("Fetch user error:",o.response?o.response.data:o)}},U=c(null),x=c([]),w=c(null),le=async()=>{try{const o=await v.get("/paymentMethod/list");x.value=o.data.paymentMethods}catch(o){console.error("Failed to load shippingMethods:",o)}},ae=async()=>{if(!w.value){console.error("No shippingMethod selected");return}try{const o=await v.post(`user/manageSelectedPayment/${w.value}`);console.log(o.data.action),console.log("PaymentMethod :",o.data.action),U.value=o.data.action,o.data.action==="Online"?await re():o.data.action==="Offline"&&(await ie(),await de())}catch(o){console.error("Failed to selected paymentMethod :",o)}},J=c([]),$=c(null),re=async()=>{try{const o=await v.get("/onlineMethodGateway/list");J.value=o.data.onlinePaymentMethods}catch(o){console.error("Failed to load onlineMethods:",o)}},D=async()=>{if(!$.value){console.error("No OnlineMethod selected");return}try{const o=JSON.parse(localStorage.getItem("order_number")),t=await v.post(`user/processPayment/${o}/${$.value}`);console.log("url :",t.data.url),window.location.href=t.data.url}catch(o){console.error("Failed to selected onlinePaymentMethods :",o)}},N=c({}),T=c({}),W=c(null),z=c(null),ie=async()=>{try{const o=await v.get("user/my/wallet");N.value=o.data.wallet}catch(o){console.error("خطا در دریافت اطلاعات کیف پول:",o)}},de=async()=>{try{const o=await v.get("user/my/coupons");T.value=o.data.coupons}catch(o){console.error("خطا در دریافت اطلاعات  کپن های کاربر:",o)}};return me(()=>{H()}),(o,t)=>{const A=ce;return r(),a(_,null,[e("div",ye,[e("div",fe,[(r(),a(_,null,g(O,(s,d)=>e("div",{key:d,class:"step-container"},[e("div",{class:y(["step-circle",{"step-active":d+1<=u.value},{"step-raised":d+1===u.value}])},[e("span",null,n(l(i)(s.number)),1)],2),e("div",ke,[e("span",null,n(s.name),1)]),d<O.length-1?(r(),a("div",{key:0,class:y(["step-line",{"line-active":d+1<u.value}])},null,2)):h("",!0)])),64))])]),e("div",be,[u.value===1?(r(),a("div",Ce,[t[12]||(t[12]=e("h2",null,"سبد خرید",-1)),e("div",we,[(r(!0),a(_,null,g(S.value.cart.items,s=>(r(),a("div",{key:s.id,class:"item-card"},[e("div",$e,[e("img",{src:s.product.image?`${l(B).public.API_BASE_URL}${s.product.image.path}`:"/default-product-image.jpg",alt:s.product.name},null,8,Se)]),e("div",Pe,[e("div",Ae,n(s.product.name),1),e("div",Ne,"قیمت:"+n(l(i)(l(p)(s.product.price))),1),e("div",Oe,"تعداد:"+n(l(i)(s.quantity)),1)]),e("div",Fe,[_e(A,{to:`/product/${s.product.id}`},{default:he(()=>t[11]||(t[11]=[e("button",{class:"product-info-btn"},"اطلاعات محصول",-1)])),_:2},1032,["to"]),e("button",{onClick:d=>K(s.product.id),class:"rm-item-card-btn"},"حذف از سبد خرید",8,Ie)])]))),128))]),e("div",Ue,[e("button",{onClick:t[0]||(t[0]=()=>{Q(),f()})},"ثبت آدرس")])])):h("",!0),u.value===2?(r(),a("div",qe,[t[16]||(t[16]=e("h2",null,"ثبت آدرس",-1)),e("div",Ee,[e("div",Me,[(r(!0),a(_,null,g(R.value,s=>(r(),a("div",{key:s.id,class:y(["address-card",{selected:P.value===s.id}]),onClick:d=>P.value=s.id},[e("div",Be,[e("h3",null,n(l(i)(s.street)),1),e("p",null,n(s.city)+", "+n(s.state)+", "+n(s.country),1)]),e("div",Re,[e("button",{onClick:G(d=>Y(s.id),["stop"]),class:"edit-address-btn"},t[13]||(t[13]=[e("i",{class:"fas fa-edit"},null,-1),k(" ویرایش ")]),8,Ve),e("button",{onClick:G(d=>Z(s.id),["stop"]),class:"select-address-btn"},t[14]||(t[14]=[e("i",{class:"fas fa-check-circle"},null,-1),k(" انتخاب ")]),8,je)])],10,Le))),128)),e("div",{class:"add-address-card",onClick:ee},t[15]||(t[15]=[e("div",{class:"add-address-icon"},[e("i",{class:"fas fa-plus"},"+")],-1),e("p",null,"افزودن آدرس جدید",-1)]))])]),e("div",xe,[e("button",{onClick:t[1]||(t[1]=()=>{X(),te(),f()})},"ثبت روش ارسال"),e("button",{onClick:b},"برگشت به سبد خرید")])])):h("",!0),u.value===3?(r(),a("div",Je,[t[17]||(t[17]=e("h2",null,"نوع ارسال",-1)),e("div",De,[e("div",Te,[(r(!0),a(_,null,g(j.value,s=>(r(),a("div",{key:s.id,class:y(["shipping-card",{selected:C.value===s.id}]),onClick:d=>C.value=s.id},[e("label",null,[q(e("input",{type:"radio",value:s.id,"onUpdate:modelValue":t[2]||(t[2]=d=>C.value=d),required:"",hidden:""},null,8,ze),[[E,C.value]]),e("h3",null,n(s.name),1),e("p",null,n(s.description),1),e("p",null,"هزینه : "+n(l(i)(s.cost)),1),e("p",null,"مدت زمان تحویل :"+n(l(i)(s.delivery_time)),1)])],10,We))),128))]),e("div",Ge,[e("button",{onClick:t[3]||(t[3]=()=>{se().then(ne).then(oe).then(f).catch(s=>console.error(s))})},"صدور فاکتور "),e("button",{onClick:b},"برگشت به انتخاب آدرس")])])])):h("",!0),u.value===4?(r(),a("div",He,[t[29]||(t[29]=e("h2",null,"صدور فاکتور",-1)),e("div",Ke,[F.value?(r(),a("div",Qe," Loading...")):h("",!0),e("div",Xe,[e("div",Ye,[t[23]||(t[23]=e("div",{class:"store-details"},[e("h2",null,"فروشگاه ایرانی")],-1)),e("div",Ze,[e("p",null,[t[18]||(t[18]=e("strong",null,"شماره فاکتور:",-1)),k(" "+n(l(i)(m.value.invoice_number)),1)]),e("p",null,[t[19]||(t[19]=e("strong",null,"تاریخ:",-1)),k(" "+n(l(i)(l(L)(m.value.created_at))),1)]),e("p",null,[t[20]||(t[20]=e("strong",null,"خریدار:",-1)),k(" "+n(I.value.name),1)]),e("p",null,[t[21]||(t[21]=e("strong",null,"تلفن:",-1)),k(" "+n(l(i)("058-362-10992")),1)]),e("p",null,[t[22]||(t[22]=e("strong",null,"پست الکترونیکی:",-1)),k(" "+n(I.value.email),1)])])]),e("div",et,[e("table",null,[t[25]||(t[25]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"تصویر"),e("th",null,"محصول"),e("th",null,"تعداد"),e("th",null,"قیمت"),e("th",null,"مجموع"),e("th",null,"تخفیف"),e("th",null,"قیمت نهایی")])],-1)),e("tbody",null,[(r(!0),a(_,null,g(m.value.items,(s,d)=>(r(),a("tr",{key:d},[e("td",null,n(d+1),1),e("td",null,[e("img",{src:s.product.image?`${l(B).public.API_BASE_URL}${s.product.image.path}`:"/default-product-image.jpg",alt:s.product.name,class:"product-image"},null,8,tt)]),e("td",null,n(s.product.name),1),e("td",null,n(l(i)(s.quantity)),1),e("td",null,n(l(i)(l(p)(s.price))),1),e("td",null,n(l(i)(l(p)(s.total))),1),e("td",null,n(l(i)(l(p)(s.discount))),1),e("td",null,n(l(i)(l(p)(s.price_with_discount))),1)]))),128)),m.value.items.length?h("",!0):(r(),a("tr",st,t[24]||(t[24]=[e("td",{colspan:"8"},"محصولی موجود نیست",-1)])))])])]),e("div",ot,[e("div",null,[t[26]||(t[26]=e("span",null,"جمع کل:",-1)),e("strong",null,n(l(i)(l(p)(m.value.sub_total_amount))),1)]),e("div",null,[e("span",null,"مالیات ("+n(l(i)(l(p)(m.value.tax_rate)))+"%):",1),e("strong",null,n(l(i)(l(p)(m.value.tax))),1)]),e("div",null,[t[27]||(t[27]=e("span",null,"هزینه ارسال:",-1)),e("strong",null,n(l(i)(l(p)(m.value.shipping_cost))),1)]),e("div",nt,[t[28]||(t[28]=e("span",null,"مجموع کل:",-1)),e("strong",null,n(l(i)(l(p)(m.value.total_amount))),1)])])])]),e("div",lt,[e("button",{onClick:t[4]||(t[4]=()=>{le().then(f).catch(s=>console.error(s))})},"انتخاب روش پرداخت "),e("button",{onClick:b},"برگست به روش ارسال")])])):h("",!0),u.value===5?(r(),a("div",at,[t[30]||(t[30]=e("h2",null,"انتخاب روش پرداخت",-1)),e("div",rt,[e("div",it,[(r(!0),a(_,null,g(x.value,s=>(r(),a("div",{key:s.id,class:y(["payment-card",{selected:w.value===s.id}]),onClick:d=>w.value=s.id},[e("label",null,[q(e("input",{type:"radio",value:s.id,"onUpdate:modelValue":t[5]||(t[5]=d=>w.value=d),required:"",hidden:""},null,8,ct),[[E,w.value]]),e("div",ut,[e("h3",null,n(s.name),1),e("img",{src:s.image?`${o.$config.public.API_BASE_URL}${s.image.path}`:"/default-payment-image.jpg",alt:s.name},null,8,vt)]),e("p",null,n(s.description),1),e("p",null,"فعال/غیرفعال : "+n(s.is_active),1)])],10,dt))),128))])]),e("div",pt,[e("button",{onClick:t[6]||(t[6]=()=>{ae().then(f).catch(s=>console.error(s))})},"انتخاب درگاه پرداخت "),e("button",{onClick:b},"برگشت به صدور فاکتور")])])):h("",!0),u.value===6&&U.value==="Online"?(r(),a("div",mt,[e("div",_t,[t[31]||(t[31]=e("h2",null,"انتخاب درگاه پرداخت",-1)),e("div",ht,[e("div",gt,[(r(!0),a(_,null,g(J.value,s=>(r(),a("div",{key:s.id,class:y(["online-card",{selected:$.value===s.id}]),onClick:d=>$.value=s.id},[q(e("input",{type:"radio",value:s.id,"onUpdate:modelValue":t[7]||(t[7]=d=>$.value=d),required:"",hidden:""},null,8,ft),[[E,$.value]]),e("h3",null,n(s.gateway),1),e("img",{src:s.image?`${o.$config.public.API_BASE_URL}${s.image.path}`:"/default-payment-image.jpg",alt:s.name},null,8,kt)],10,yt))),128))]),e("div",bt,[e("button",{onClick:t[8]||(t[8]=()=>{D().then(f).catch(s=>console.error(s))})},"اتصال به درگاه "),e("button",{onClick:b},"برگشت به انتخاب روش پرداخت")])])])])):u.value===6&&U.value==="Offline"?(r(),a("div",Ct,[e("div",wt,[t[36]||(t[36]=e("h2",null,"انتخاب درگاه پرداخت",-1)),e("div",$t,[e("div",St,[t[33]||(t[33]=e("div",null,[e("p",null,"کیف پول")],-1)),e("div",{class:y(["wallet-card",{selected:z.value===N.value.id}]),onClick:t[9]||(t[9]=s=>z.value=N.value.id)},[t[32]||(t[32]=e("span",null,"موجودی: ",-1)),e("strong",null,n(l(i)(l(p)(N.value.balance)))+" تومان",1)],2)]),e("div",Pt,[t[35]||(t[35]=e("p",null,"کارت های اعتباری",-1)),(r(!0),a(_,null,g(T.value,s=>(r(),a("div",{key:s.id,class:y(["coupon-card",{selected:W.value===s.id}]),onClick:d=>W.value=s.id},[e("div",Nt,[e("div",Ot,n(l(i)(s.code)),1),e("div",Ft,"تاریخ اعتبار: "+n(l(i)(l(L)(s.created_at))),1)]),e("div",It,[e("p",null,"تخفیف : "+n(l(i)(s.discount_amount))+" "+n(s.discount_type),1),e("p",null,"توضیحات : "+n(s.description),1)]),e("div",Ut,[e("div",qt,n(s.is_used?"استفاده شده":"اعتبار دارد"),1),t[34]||(t[34]=e("div",{class:"coupon-actions"},[e("a",{href:"#"},"Use Coupon")],-1))])],10,At))),128))]),e("div",Et,[e("button",{onClick:t[10]||(t[10]=()=>{D().then(f).catch(s=>console.error(s))})},"پرداخت سفارش "),e("button",{onClick:b},"برگشت به انتخاب روش پرداخت")])])])])):h("",!0)])],64)}}},Vt=ue(Mt,[["__scopeId","data-v-5e2a271f"]]);export{Vt as default};
